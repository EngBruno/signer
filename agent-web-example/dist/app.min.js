angular.module("agent-desktop",[]).controller("controller",["$scope","$http","$timeout",function(n,e,t){function i(){window.SignerDesktopClient.connect(callback)}n.listaCertificados=null,n.listaPoliticas=[],n.politica=null,n.password=null,n.signed=null,n.erros=null,n.fileName=null,n.signedFileName=null,connectionStatus=-1,callback=function(n){connectionStatus=n,elementMessage=document.getElementById("serverstate"),1==n?elementMessage.innerHTML="Conectado ao servidor":(elementMessage.innerHTML="<a href='agent-desktop.jnlp' download> Baixar/Executar Agent-Desktop </a>",setTimeout(i,3e3))},window.SignerDesktopClient.connect(callback),n.listarCertificados=function(){window.SignerDesktopClient.listcerts(n.password).then(function(e){t(function(){n.listaCertificados=e},100)})},n.tratarErros=function(e){n.erros=e.erro,alert("Erro. "+e.erro)},n.assinar=function(e,i,o){window.SignerDesktopClient.signer(e,n.password,i,o,n.politica).then(function(e){return e.erro?void n.tratarErros(e):void t(function(){n.signed=e.signed},100)})},n.status=function(){window.SignerDesktopClient.status().then(function(e){if(e.erro)return void n.tratarErros(e)})},n.listarPoliticas=function(){window.SignerDesktopClient.listpolicies().then(function(e){return e.erro?void n.tratarErros(e):void t(function(){n.listaPoliticas=e.policies},100)})},n.shutdown=function(){window.SignerDesktopClient.shutdown()},n.logout=function(){window.SignerDesktopClient.logoutpkcs11()},n.getfiles=function(){window.SignerDesktopClient.getfiles().then(function(e){return e.erro?void n.tratarErros(e):void t(function(){n.fileName=e.fileName},100)})},n.assinarArquivo=function(e,i,o){return null==o||null==e?void alert("Informe o arquivo e a politica a ser utilizada"):void window.SignerDesktopClient.signerfile(e,i,n.fileName,n.politica).then(function(e){return e.erro?void n.tratarErros(e):void t(function(){n.signedFileName=e.signed},100)})}}]);