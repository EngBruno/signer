angular.module("agent",[]).controller("MainController",["$scope","$http","$timeout",function(e,i,n){function t(i){1===i?(console.log("Connected on Server"),e.serverIsOn=!0,e.listAllPolicies(),clearInterval(s)):(console.log("Warn user to download/execute Agent-Desktop AND try again in 5000ms"),e.serverIsOn=!1,s=setTimeout(function(){window.SignerDesktopClient.connect(t,t,o)},5e3))}function o(i){n(function(){e.errors=i},100)}e.listCertificates=null,e.listAllPolicies=[],e.policy=null,e.signed=null,e.errors,e.fileName=null,e.serverIsOn=!1,e.selectedCertificate=null;var s;window.SignerDesktopClient.setDebug(!0),window.SignerDesktopClient.connect(t,t,o),e.listCerts=function(){window.SignerDesktopClient.listCerts().success(function(i){n(function(){e.listCertificates=i},100)})},e.setCertificate=function(i){console.log(i.alias),e.selectedCertificate=i},e.signText=function(i){window.SignerDesktopClient.signer(e.selectedCertificate.alias,e.selectedCertificate.provider,i,e.policy).success(function(i){n(function(){e.signed=i.signed},100)})},e.listAllPolicies=function(){window.SignerDesktopClient.listPolicies().success(function(i){n(function(){e.listPolicies=i.policies,e.policy="AD_RB_CADES_2_2"},100)})},e.getfiles=function(){window.SignerDesktopClient.getFiles().success(function(i){n(function(){e.fileName=i.fileName},100)})},e.assinarArquivo=function(i){window.SignerDesktopClient.signerFile(e.selectedCertificate.alias,e.selectedCertificate.provider,e.fileName,e.policy).success(function(i){n(function(){e.signedFileName=i.signed},100)})},e.status=function(){window.SignerDesktopClient.status().success(function(e){console.log(e)})},e.shutdown=function(){window.SignerDesktopClient.shutdown()},e.logout=function(){window.SignerDesktopClient.logoutPKCS11()}}]);